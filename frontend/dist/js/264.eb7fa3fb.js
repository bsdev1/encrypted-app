(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[264],{2264:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return T}});var s=i(4562),n=i(7394),a=i(4324),r=i(3305),o=i(9592),l=i(4712),d=i(6878),c=i(7678),h=i(5352);const u=(0,c.Z)(d.Z,(0,l.f)("treeview")),p={activatable:Boolean,activeClass:{type:String,default:"v-treeview-node--active"},color:{type:String,default:"primary"},disablePerNode:Boolean,expandIcon:{type:String,default:"$subgroup"},indeterminateIcon:{type:String,default:"$checkboxIndeterminate"},itemChildren:{type:String,default:"children"},itemDisabled:{type:String,default:"disabled"},itemKey:{type:String,default:"id"},itemText:{type:String,default:"name"},loadChildren:Function,loadingIcon:{type:String,default:"$loading"},offIcon:{type:String,default:"$checkboxOff"},onIcon:{type:String,default:"$checkboxOn"},openOnClick:Boolean,rounded:Boolean,selectable:Boolean,selectedColor:{type:String,default:"accent"},shaped:Boolean,transition:Boolean,selectionType:{type:String,default:"leaf",validator:e=>["leaf","independent"].includes(e)}},m=u.extend().extend({name:"v-treeview-node",inject:{treeview:{default:null}},props:{level:Number,item:{type:Object,default:()=>null},parentIsDisabled:Boolean,...p},data:()=>({hasLoaded:!1,isActive:!1,isIndeterminate:!1,isLoading:!1,isOpen:!1,isSelected:!1}),computed:{disabled(){return(0,h.vO)(this.item,this.itemDisabled)||!this.disablePerNode&&this.parentIsDisabled&&"leaf"===this.selectionType},key(){return(0,h.vO)(this.item,this.itemKey)},children(){const e=(0,h.vO)(this.item,this.itemChildren);return e&&e.filter((e=>!this.treeview.isExcluded((0,h.vO)(e,this.itemKey))))},text(){return(0,h.vO)(this.item,this.itemText)},scopedProps(){return{item:this.item,leaf:!this.children,selected:this.isSelected,indeterminate:this.isIndeterminate,active:this.isActive,open:this.isOpen}},computedIcon(){return this.isIndeterminate?this.indeterminateIcon:this.isSelected?this.onIcon:this.offIcon},hasChildren(){return!!this.children&&(!!this.children.length||!!this.loadChildren)}},created(){this.treeview.register(this)},beforeDestroy(){this.treeview.unregister(this)},methods:{checkChildren(){return new Promise((e=>{if(!this.children||this.children.length||!this.loadChildren||this.hasLoaded)return e();this.isLoading=!0,e(this.loadChildren(this.item))})).then((()=>{this.isLoading=!1,this.hasLoaded=!0}))},open(){this.isOpen=!this.isOpen,this.treeview.updateOpen(this.key,this.isOpen),this.treeview.emitOpen()},genLabel(){const e=[];return this.$scopedSlots.label?e.push(this.$scopedSlots.label(this.scopedProps)):e.push(this.text),this.$createElement("div",{slot:"label",staticClass:"v-treeview-node__label"},e)},genPrependSlot(){return this.$scopedSlots.prepend?this.$createElement("div",{staticClass:"v-treeview-node__prepend"},this.$scopedSlots.prepend(this.scopedProps)):null},genAppendSlot(){return this.$scopedSlots.append?this.$createElement("div",{staticClass:"v-treeview-node__append"},this.$scopedSlots.append(this.scopedProps)):null},genContent(){const e=[this.genPrependSlot(),this.genLabel(),this.genAppendSlot()];return this.$createElement("div",{staticClass:"v-treeview-node__content"},e)},genToggle(){return this.$createElement(a.Z,{staticClass:"v-treeview-node__toggle",class:{"v-treeview-node__toggle--open":this.isOpen,"v-treeview-node__toggle--loading":this.isLoading},slot:"prepend",on:{click:e=>{e.stopPropagation(),this.isLoading||this.checkChildren().then((()=>this.open()))}}},[this.isLoading?this.loadingIcon:this.expandIcon])},genCheckbox(){return this.$createElement(a.Z,{staticClass:"v-treeview-node__checkbox",props:{color:this.isSelected||this.isIndeterminate?this.selectedColor:void 0,disabled:this.disabled},on:{click:e=>{e.stopPropagation(),this.isLoading||this.checkChildren().then((()=>{this.$nextTick((()=>{this.isSelected=!this.isSelected,this.isIndeterminate=!1,this.treeview.updateSelected(this.key,this.isSelected),this.treeview.emitSelected()}))}))}}},[this.computedIcon])},genLevel(e){return(0,h.MT)(e).map((()=>this.$createElement("div",{staticClass:"v-treeview-node__level"})))},genNode(){const e=[this.genContent()];return this.selectable&&e.unshift(this.genCheckbox()),this.hasChildren?e.unshift(this.genToggle()):e.unshift(...this.genLevel(1)),e.unshift(...this.genLevel(this.level)),this.$createElement("div",this.setTextColor(this.isActive&&this.color,{staticClass:"v-treeview-node__root",class:{[this.activeClass]:this.isActive},on:{click:()=>{this.openOnClick&&this.hasChildren?this.checkChildren().then(this.open):this.activatable&&!this.disabled&&(this.isActive=!this.isActive,this.treeview.updateActive(this.key,this.isActive),this.treeview.emitActive())}}}),e)},genChild(e,t){return this.$createElement(m,{key:(0,h.vO)(e,this.itemKey),props:{activatable:this.activatable,activeClass:this.activeClass,item:e,selectable:this.selectable,selectedColor:this.selectedColor,color:this.color,disablePerNode:this.disablePerNode,expandIcon:this.expandIcon,indeterminateIcon:this.indeterminateIcon,offIcon:this.offIcon,onIcon:this.onIcon,loadingIcon:this.loadingIcon,itemKey:this.itemKey,itemText:this.itemText,itemDisabled:this.itemDisabled,itemChildren:this.itemChildren,loadChildren:this.loadChildren,transition:this.transition,openOnClick:this.openOnClick,rounded:this.rounded,shaped:this.shaped,level:this.level+1,selectionType:this.selectionType,parentIsDisabled:t},scopedSlots:this.$scopedSlots})},genChildrenWrapper(){if(!this.isOpen||!this.children)return null;const e=[this.children.map((e=>this.genChild(e,this.disabled)))];return this.$createElement("div",{staticClass:"v-treeview-node__children"},e)},genTransition(){return this.$createElement(n.Fx,[this.genChildrenWrapper()])}},render(e){const t=[this.genNode()];return this.transition?t.push(this.genTransition()):t.push(this.genChildrenWrapper()),e("div",{staticClass:"v-treeview-node",class:{"v-treeview-node--leaf":!this.hasChildren,"v-treeview-node--click":this.openOnClick,"v-treeview-node--disabled":this.disabled,"v-treeview-node--rounded":this.rounded,"v-treeview-node--shaped":this.shaped,"v-treeview-node--selected":this.isSelected},attrs:{"aria-expanded":String(this.isOpen)}},t)}});var g=m,v=i(6669),f=i(4808);function y(e,t,i){const s=(0,h.vO)(e,i);return s.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())>-1}function C(e,t,i,s,n,a,r){if(e(t,i,n))return!0;const o=(0,h.vO)(t,a);if(o){let t=!1;for(let l=0;l<o.length;l++)C(e,o[l],i,s,n,a,r)&&(t=!0);if(t)return!0}return r.add((0,h.vO)(t,s)),!1}var _=(0,c.Z)((0,l.J)("treeview"),v.Z).extend({name:"v-treeview",provide(){return{treeview:this}},props:{active:{type:Array,default:()=>[]},dense:Boolean,disabled:Boolean,filter:Function,hoverable:Boolean,items:{type:Array,default:()=>[]},multipleActive:Boolean,open:{type:Array,default:()=>[]},openAll:Boolean,returnObject:{type:Boolean,default:!1},search:String,value:{type:Array,default:()=>[]},...p},data:()=>({level:-1,activeCache:new Set,nodes:{},openCache:new Set,selectedCache:new Set}),computed:{excludedItems(){const e=new Set;if(!this.search)return e;for(let t=0;t<this.items.length;t++)C(this.filter||y,this.items[t],this.search,this.itemKey,this.itemText,this.itemChildren,e);return e}},watch:{items:{handler(){const e=Object.keys(this.nodes).map((e=>(0,h.vO)(this.nodes[e].item,this.itemKey))),t=this.getKeys(this.items),i=(0,h.tX)(t,e);if(!i.length&&t.length<e.length)return;i.forEach((e=>delete this.nodes[e]));const s=[...this.selectedCache];this.selectedCache=new Set,this.activeCache=new Set,this.openCache=new Set,this.buildTree(this.items),(0,h.vZ)(s,[...this.selectedCache])||this.emitSelected()},deep:!0},active(e){this.handleNodeCacheWatcher(e,this.activeCache,this.updateActive,this.emitActive)},value(e){this.handleNodeCacheWatcher(e,this.selectedCache,this.updateSelected,this.emitSelected)},open(e){this.handleNodeCacheWatcher(e,this.openCache,this.updateOpen,this.emitOpen)}},created(){const e=e=>this.returnObject?(0,h.vO)(e,this.itemKey):e;this.buildTree(this.items);for(const t of this.value.map(e))this.updateSelected(t,!0,!0);for(const t of this.active.map(e))this.updateActive(t,!0)},mounted(){(this.$slots.prepend||this.$slots.append)&&(0,f.Kd)("The prepend and append slots require a slot-scope attribute",this),this.openAll?this.updateAll(!0):(this.open.forEach((e=>this.updateOpen(this.returnObject?(0,h.vO)(e,this.itemKey):e,!0))),this.emitOpen())},methods:{updateAll(e){Object.keys(this.nodes).forEach((t=>this.updateOpen((0,h.vO)(this.nodes[t].item,this.itemKey),e))),this.emitOpen()},getKeys(e,t=[]){for(let i=0;i<e.length;i++){const s=(0,h.vO)(e[i],this.itemKey);t.push(s);const n=(0,h.vO)(e[i],this.itemChildren);n&&t.push(...this.getKeys(n))}return t},buildTree(e,t=null){var i;for(let s=0;s<e.length;s++){const n=e[s],a=(0,h.vO)(n,this.itemKey),r=null!==(i=(0,h.vO)(n,this.itemChildren))&&void 0!==i?i:[],o=this.nodes.hasOwnProperty(a)?this.nodes[a]:{isSelected:!1,isIndeterminate:!1,isActive:!1,isOpen:!1,vnode:null},l={vnode:o.vnode,parent:t,children:r.map((e=>(0,h.vO)(e,this.itemKey))),item:n};if(this.buildTree(r,a),"independent"!==this.selectionType&&null!==t&&!this.nodes.hasOwnProperty(a)&&this.nodes.hasOwnProperty(t)?l.isSelected=this.nodes[t].isSelected:(l.isSelected=o.isSelected,l.isIndeterminate=o.isIndeterminate),l.isActive=o.isActive,l.isOpen=o.isOpen,this.nodes[a]=l,r.length&&"independent"!==this.selectionType){const{isSelected:e,isIndeterminate:t}=this.calculateState(a,this.nodes);l.isSelected=e,l.isIndeterminate=t}!this.nodes[a].isSelected||"independent"!==this.selectionType&&0!==l.children.length||this.selectedCache.add(a),this.nodes[a].isActive&&this.activeCache.add(a),this.nodes[a].isOpen&&this.openCache.add(a),this.updateVnodeState(a)}},calculateState(e,t){const i=t[e].children,s=i.reduce(((e,i)=>(e[0]+=+Boolean(t[i].isSelected),e[1]+=+Boolean(t[i].isIndeterminate),e)),[0,0]),n=!!i.length&&s[0]===i.length,a=!n&&(s[0]>0||s[1]>0);return{isSelected:n,isIndeterminate:a}},emitOpen(){this.emitNodeCache("update:open",this.openCache)},emitSelected(){this.emitNodeCache("input",this.selectedCache)},emitActive(){this.emitNodeCache("update:active",this.activeCache)},emitNodeCache(e,t){this.$emit(e,this.returnObject?[...t].map((e=>this.nodes[e].item)):[...t])},handleNodeCacheWatcher(e,t,i,s){e=this.returnObject?e.map((e=>(0,h.vO)(e,this.itemKey))):e;const n=[...t];(0,h.vZ)(n,e)||(n.forEach((e=>i(e,!1))),e.forEach((e=>i(e,!0))),s())},getDescendants(e,t=[]){const i=this.nodes[e].children;t.push(...i);for(let s=0;s<i.length;s++)t=this.getDescendants(i[s],t);return t},getParents(e){let t=this.nodes[e].parent;const i=[];while(null!==t)i.push(t),t=this.nodes[t].parent;return i},register(e){const t=(0,h.vO)(e.item,this.itemKey);this.nodes[t].vnode=e,this.updateVnodeState(t)},unregister(e){const t=(0,h.vO)(e.item,this.itemKey);this.nodes[t]&&(this.nodes[t].vnode=null)},isParent(e){return this.nodes[e].children&&this.nodes[e].children.length},updateActive(e,t){if(!this.nodes.hasOwnProperty(e))return;this.multipleActive||this.activeCache.forEach((e=>{this.nodes[e].isActive=!1,this.updateVnodeState(e),this.activeCache.delete(e)}));const i=this.nodes[e];i&&(t?this.activeCache.add(e):this.activeCache.delete(e),i.isActive=t,this.updateVnodeState(e))},updateSelected(e,t,i=!1){if(!this.nodes.hasOwnProperty(e))return;const s=new Map;if("independent"!==this.selectionType){for(const a of this.getDescendants(e))(0,h.vO)(this.nodes[a].item,this.itemDisabled)&&!i||(this.nodes[a].isSelected=t,this.nodes[a].isIndeterminate=!1,s.set(a,t));const n=this.calculateState(e,this.nodes);this.nodes[e].isSelected=t,this.nodes[e].isIndeterminate=n.isIndeterminate,s.set(e,t);for(const t of this.getParents(e)){const e=this.calculateState(t,this.nodes);this.nodes[t].isSelected=e.isSelected,this.nodes[t].isIndeterminate=e.isIndeterminate,s.set(t,e.isSelected)}}else this.nodes[e].isSelected=t,this.nodes[e].isIndeterminate=!1,s.set(e,t);for(const[n,a]of s.entries())this.updateVnodeState(n),"leaf"===this.selectionType&&this.isParent(n)||(!0===a?this.selectedCache.add(n):this.selectedCache.delete(n))},updateOpen(e,t){if(!this.nodes.hasOwnProperty(e))return;const i=this.nodes[e],s=(0,h.vO)(i.item,this.itemChildren);s&&!s.length&&i.vnode&&!i.vnode.hasLoaded?i.vnode.checkChildren().then((()=>this.updateOpen(e,t))):s&&s.length&&(i.isOpen=t,i.isOpen?this.openCache.add(e):this.openCache.delete(e),this.updateVnodeState(e))},updateVnodeState(e){const t=this.nodes[e];t&&t.vnode&&(t.vnode.isSelected=t.isSelected,t.vnode.isIndeterminate=t.isIndeterminate,t.vnode.isActive=t.isActive,t.vnode.isOpen=t.isOpen)},isExcluded(e){return!!this.search&&this.excludedItems.has(e)}},render(e){const t=this.items.length?this.items.filter((e=>!this.isExcluded((0,h.vO)(e,this.itemKey)))).map((e=>{const t=g.options.methods.genChild.bind(this);return t(e,this.disabled||(0,h.vO)(e,this.itemDisabled))})):this.$slots.default;return e("div",{staticClass:"v-treeview",class:{"v-treeview--hoverable":this.hoverable,"v-treeview--dense":this.dense,...this.themeClasses}},t)}}),w=function(){var e=this,t=e._self._c;return t("div",{staticClass:"message pr-4 py-2 pb-4",attrs:{"data-id":e.id}},[t("div",{staticClass:"message__flex d-flex"},[e.interval?t("div",{staticClass:"expiration__progress__wrapper mr-4"},[t("div",{staticStyle:{position:"relative"}},[t("mdicon",{attrs:{name:"clock-outline",size:"18"}}),t(r.Z,{key:e.updateExpiration,staticClass:"expiration__progress",attrs:{size:"24",value:e.expireProgress}},[t(a.Z,[e._v("mdi-folder")])],1)],1),t("div",{staticClass:"expiration__tooltip"},[e._v(" Auto-Destruction in about "+e._s(e.$msToReadeableTime(e.expiration))+" ")])]):e._e(),t("MessageContent",{key:e.messageUpdate,attrs:{id:e.id,username:e.author.username,"created-at":e.createdAt}}),t("div",{staticClass:"message__options ml-auto d-flex"},[t(s.Z,{staticClass:"message__btn__copy",attrs:{title:"Copy Message",small:""},on:{click:function(t){return e.copyMessage(e.content)}}},[t("mdicon",{attrs:{name:"content-copy"}})],1),t(s.Z,{staticClass:"message__btn__edit ml-2",attrs:{disabled:e.applyingChanges,title:"Edit Message",small:""},on:{click:function(t){return e.editMessage(e.id)}}},[t("mdicon",{attrs:{name:"pencil"}})],1),t(s.Z,{staticClass:"message__btn__delete ml-2",attrs:{loading:e.applyingChanges,title:"Delete Message",small:""},on:{click:function(t){return e.removeMessage(e.id)}}},[t("mdicon",{attrs:{name:"close"}})],1)],1)],1),t("div",{staticClass:"message__files"},[t(n.Z5,[e.currentMessage==e.id&&e.currentParentDownloadPercent>0&&e.currentParentDownloadPercent<100?t(o.Z,{staticClass:"mt-3 mb-4",attrs:{value:e.currentParentDownloadPercent,color:"cyan"}}):e._e()],1),t(_,{attrs:{items:e.fileDescriptions,"open-on-click":"",rounded:""},scopedSlots:e._u([{key:"label",fn:function({item:{size:i,name:n,type:a,uuid:r,notFound:o}}){return[n&&r?t("div",[t("div",{class:(e.showable(a)&&e.fileSrc(r),"pa-4"),staticStyle:{cursor:"default","user-select":"text"}},[t("div",{staticClass:"text-caption d-flex flex-column"},[o?t("div",{staticClass:"red--text font-weight-bold mb-1"},[e._v(" File not found ")]):e._e(),t("div",[t("span",{staticClass:"file__info"},[t("span",{class:{"text-decoration-line-through grey--text lighten-1":o}},[e._v(" Type: "+e._s(a||"Unknown Type")+" ")]),t("div",{staticClass:"file__tooltip"},[e._v(" "+e._s(a||"Unknown Type")+" ")])])]),t("div",[t("span",{staticClass:"file__info"},[t("span",{class:{"text-decoration-line-through grey--text lighten-1":o}},[e._v(" Name: "+e._s(n)+" ")]),t("div",{staticClass:"file__tooltip"},[e._v(e._s(n))])])]),t("div",[t("span",{staticClass:"file__info"},[t("span",{class:{"text-decoration-line-through grey--text lighten-1":o}},[e._v(" File Size: "+e._s(e.$filesize(i))+" ")]),t("div",{staticClass:"file__tooltip"},[e._v(e._s(e.$filesize(i)))])])])]),e.fileSrc(r)?t("span",[e.file(r)||e.isFetchedFiles?t(s.Z,{staticClass:"d-block mt-2 pa-0",attrs:{small:""}},[t("a",{staticClass:"d-flex align-center px-3 text-decoration-none white--text",staticStyle:{height:"28px"},attrs:{target:"_blank",download:e.file(r).name,href:e.fileSrc(r).src}},[e._v(" Download File ")])]):e._e(),e.showable(a)?t("div",[a.startsWith("image")?t("img",{staticClass:"mt-5",staticStyle:{"max-width":"100%"},attrs:{alt:"",src:e.fileSrc(r).src,height:"150"}}):e._e(),a.startsWith("video")?t("video",{staticClass:"mt-5",staticStyle:{"max-width":"100%"},attrs:{height:"300",controls:""}},[t("source",{attrs:{src:e.fileSrc(r).src}})]):e._e(),a.startsWith("audio")?t("audio",{staticClass:"mt-5",staticStyle:{"max-width":"100%"},attrs:{controls:""}},[t("source",{attrs:{src:e.fileSrc(r).src,type:a}})]):e._e()]):e._e()],1):t("div",[e.currentFetchedFile==r&&i>e.chunkSize?t("div",{staticClass:"text-caption mt-1"},[e._v(" "+e._s(e.currentDownload.percentage)+"% ")]):e._e(),t(s.Z,{staticClass:"d-block mt-2",attrs:{small:"",disabled:e.fetchingFiles.running||o||e.currentFetchedFile&&e.currentFetchedFile!=r||e.currentFetchedFile==r},on:{click:function(t){return e.fetchFile(r,e.id)}}},[e._v(" "+e._s(e.currentFetchedFile==r?"Fetching File...":"Fetch File")+" ")])],1)])]):t("div",[e.currentFetchedFileParent==n?t("span",[e._v(" Downloading from ")]):e._e(),e._v(" "+e._s(n)+" "),e.currentFetchedFileParent==n?[e._v("...")]:e._e()],2)]}},{key:"prepend",fn:function({item:{type:i,uuid:s},open:n}){return[t("div",{class:{"ml-3 mt-5":null!=s&&"folder-open"!=i}},[t("mdicon",i||s?{attrs:{name:i.startsWith("image")?"file-image":i.startsWith("audio")?"file-music":i.startsWith("video")?"file-video":i&&null!=e.filesTypes[i]?e.filesTypes[i]:"file-question"}}:{attrs:{name:n?"folder-open":"folder"}})],1)]}}])}),e.currentMessageFiles(e.id)<e.filesCount-e.filesNotFoundCount&&e.filesCount-e.filesNotFoundCount&&!e.isFetchedFiles?t(s.Z,{staticClass:"fetch__files__btn my-2 mt-3",attrs:{disabled:e.fetchingFiles.running||null!=e.currentFetchedFile},on:{click:function(t){return e.fetchFiles(e.id)}}},[t("mdicon",{staticClass:"ml-n1 mr-2",attrs:{name:"download"}}),e._v(" "+e._s(e.fetchingFiles.running&&"multiple"==e.fetchingFiles.type?"Fetching":"Fetch")+" File(s), "+e._s(e.$filesize(e.totalSize))+" ")],1):e._e()],1)])},S=[],b=i(629),x=i(4011),O=i(3214),F=i(1789),I=i(8661),M={name:"Message",components:{MessageContent:x["default"]},props:{message:Object},data(){return{...this.message,language:navigator.language,applyingChanges:!1,updateExpiration:0,interval:null,expireProgress:0,filesTypes:{"text/html":"language-html5","text/javascript":"nodejs","application/json":"code-json","application/pdf":"file-pdf","text/plain":"file-document-outline","application/x-msdownload":"file-download","application/vnd.ms-excel":"file-excel","application/x-zip-compressed":"folder-zip"},allowedShowTypes:["image","video","audio"],chunkSize:F.MAXIMUM_CHUNK_SIZE}},computed:{totalSize(){let e=0;return this.fileDescriptions.forEach((({children:t})=>t.forEach((t=>e+=t.size)))),e},fileSrc(){return function(e){return this.isFetchedFiles?this.files.find((t=>t.uuid==e)):(this.files.length?this.files:this.tempDecryptedFiles).find((t=>t.uuid==e))}},currentMessageFiles(){return function(e){return this.files.filter((({messageId:t})=>t==e)).length}},isFetchedFiles(){return this.files.length&&this.files.map((({notFetched:e})=>e)).includes(!0)},filesNotFoundCount(){return this.fileDescriptions.map((e=>e.children.filter((e=>e.notFound)))).flat(2).length},currentFetchedFileParent(){const{fileDescriptions:e,currentFetchedFile:t}=this,i=e.find((e=>e.children.find((e=>e.uuid==t))));return i?.name},downloadedByParent(){return function(e){const{files:t,fileDescriptions:i}=this,s=i.filter((t=>t.name==e)).map((e=>e.children.map((e=>e.uuid)))).flat();return t.filter((e=>s.includes(e.uuid))).length}},...(0,b.rn)(["selectedTime","currentParentDownloadPercent","loadingNewMessages","messageUpdate","tempDecryptedFiles","currentMessage","fetchingFiles","currentFetchedFile","messages","socket","currentDownload","currentEditedMessageId"])},created(){this.expiration&&this.startUpdateExpirationInterval()},methods:{startUpdateExpirationInterval(){const{createdAt:e,expiration:t,setMessages:i,$getExpireProgress:s,messages:n,id:a}=this,r=s(e,new Date(e).getTime()+t);if(this.expireProgress=r,this.updateExpiration=0==this.updateExpiration?1:0,this.expireProgress>=100)return clearTimeout(this.interval),i(n.filter((e=>e.id!=a)));this.interval=setTimeout((()=>{this.startUpdateExpirationInterval()}),1e3)},async fetchFiles(e){const{setFetchingFiles:t,setTempDecryptedFiles:i,handleFetchFiles:s}=this;t({type:"multiple",running:!0});const n=await(0,I.uI)();let a=await s({messageId:e,importedKey:n});t({type:"multiple",running:!1}),a=a.map((t=>({...t,messageId:e}))),this.files=[...this.files,...a],i([])},async fetchFile(e,t){const{logOut:i,setFetchingFiles:s,setTempDecryptedFiles:n,handleFetchFile:a,setCurrentFetchedFile:r}=this;r(e);const{data:{success:o}}=await O.WY.get("/");if(0==o)return i();s({type:"single",running:!0});const l=await(0,I.uI)(),[d]=await a({messageId:t,uuid:e,importedKey:l});d&&this.files.push({...d,messageId:t}),s({type:"single",running:!1}),n([])},isAllowedType(e){return this.allowedShowTypes.filter((t=>e.startsWith(t))).length},showable(e){const{isAllowedType:t}=this;return t(e)},file(e){const{files:t,tempDecryptedFiles:i}=this;return(t.length?t:i).find((t=>t.uuid==e))},editMessage(e){const{currentEditedMessageId:t,setCurrentEditedMessageId:i,setSendMessageError:s}=this;if(s(null),t==e)return i(null);i(e)},async copyMessage(e){try{await navigator.clipboard.writeText(e),this.$notify({text:"Successfully copied a message!",type:"success"})}catch(t){this.$notify({text:"Something went wrong while copying a message!",type:"error"})}},async removeMessage(e){const{handleRemoveMessage:t,messages:i,setMessages:s,$notify:n,socket:a,loadingNewMessages:r,setLoadingNewMessages:o}=this,l=[...document.querySelectorAll(".message")].find((t=>t.getAttribute("data-id")==e));if(l.getAttribute("data-next")||r)return o(!1);this.applyingChanges=!0;const{error:d}=await t(e);if(this.applyingChanges=!1,s(i.filter((t=>t.id!=e))),d)return n({text:d,type:"error"});n({text:"Successfully removed a message.",type:"success"}),a.emit("removeMessage",e)},...(0,b.OI)(["setSendMessageError","setCurrentFetchedFile","setLoadingNewMessages","setTempDecryptedFiles","setFetchingFiles","setMessages","setCurrentEditedMessageId"]),...(0,b.nv)(["handleFetchFiles","handleFetchFile","logOut","handleRemoveMessage"])}},k=M,E=i(1001),A=(0,E.Z)(k,w,S,!1,null,"10a2f9ae",null),T=A.exports},4011:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return g}});var s=i(1653),n=i(4562),a=i(7394),r=i(7808),o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"message__content pr-7"},[t("div",[e._v(" by "),t("b",[e._v(e._s(e.username))]),e._v(" - "+e._s(e.$getNormalizedDate(e.createdAt))+" "),e.edited?t("div",{staticClass:"text-caption grey--text ml-2 d-inline pb-1"},[e._v(" (edited) ")]):e._e()]),e.currentEditedMessageId==e.id?t("div",{staticClass:"mt-3"},[t(a.cu,[e.editMessageError?t(s.Z,{attrs:{type:"error",color:"red",dense:""}},[e._v(" "+e._s(e.editMessageError)+" ")]):e._e()],1),t("form",{staticClass:"d-flex",on:{submit:function(t){return t.preventDefault(),e.finishEditMessage(e.id)}}},[t(r.Z,{attrs:{height:"40",label:"Edit Message",solo:"",placeholder:"Type In Your Edit Message","hide-details":"",dense:""},model:{value:e.editMessageContent,callback:function(t){e.editMessageContent=t},expression:"editMessageContent"}}),t(n.Z,{staticClass:"finish__edit__btn ml-4",attrs:{type:"submit",loading:e.applyingChanges}},[t("mdicon",{attrs:{name:"check"}})],1)],1)],1):t("div",{staticClass:"message__content",domProps:{innerHTML:e._s(e.$sanitizeHTML(e.$anchors({input:e.content,options:{attributes:{target:"_blank"}}})))}})])},l=[],d=i(629),c=i(3214),h={name:"MessageContent",props:{id:String,username:String,createdAt:String},data(){return{content:"",editMessageContent:"",edited:!1,editMessageError:null,applyingChanges:!1}},computed:(0,d.rn)(["currentEditedMessageId","messages","socket"]),created(){const{content:e,edited:t}=this.messages.find((e=>e.id==this.id));this.editMessageContent=e,this.content=e,this.edited=t},methods:{async finishEditMessage(e){let{editMessageContent:t,handleEditMessage:i,content:s,setCurrentEditedMessageId:n,setSendMessageError:a,socket:r}=this;if(a(null),t==s)return this.editMessageError=null,n(null),this.content=t;if(!t?.trim())return this.editMessageError="Edit message cannot be empty.";const o=localStorage.getItem("key");this.applyingChanges=!0;const{error:l}=await i({id:e,editMessageContent:(0,c.HI)(t,o)});if(this.applyingChanges=!1,l)return this.editMessageError=l;n(null),this.content=t,this.editActive=!1,this.editMessageError=null,this.edited=!0,this.$notify({text:"Successfully edited a message.",type:"success"}),r.emit("editedMessage",{id:e,newContent:(0,c.HI)(t,o)})},...(0,d.nv)(["handleEditMessage"]),...(0,d.OI)(["setCurrentEditedMessageId","setSendMessageError"])}},u=h,p=i(1001),m=(0,p.Z)(u,o,l,!1,null,"1790faae",null),g=m.exports},1223:function(e,t,i){var s=i(5112),n=i(30),a=i(3070).f,r=s("unscopables"),o=Array.prototype;void 0==o[r]&&a(o,r,{configurable:!0,value:n(null)}),e.exports=function(e){o[r][e]=!0}},490:function(e,t,i){var s=i(5005);e.exports=s("document","documentElement")},30:function(e,t,i){var s,n=i(9670),a=i(6048),r=i(748),o=i(3501),l=i(490),d=i(317),c=i(6200),h=">",u="<",p="prototype",m="script",g=c("IE_PROTO"),v=function(){},f=function(e){return u+m+h+e+u+"/"+m+h},y=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},C=function(){var e,t=d("iframe"),i="java"+m+":";return t.style.display="none",l.appendChild(t),t.src=String(i),e=t.contentWindow.document,e.open(),e.write(f("document.F=Object")),e.close(),e.F},_=function(){try{s=new ActiveXObject("htmlfile")}catch(t){}_="undefined"!=typeof document?document.domain&&s?y(s):C():y(s);var e=r.length;while(e--)delete _[p][r[e]];return _()};o[g]=!0,e.exports=Object.create||function(e,t){var i;return null!==e?(v[p]=n(e),i=new v,v[p]=null,i[g]=e):i=_(),void 0===t?i:a.f(i,t)}},6048:function(e,t,i){var s=i(9781),n=i(3353),a=i(3070),r=i(9670),o=i(5656),l=i(1956);t.f=s&&!n?Object.defineProperties:function(e,t){r(e);var i,s=o(t),n=l(t),d=n.length,c=0;while(d>c)a.f(e,i=n[c++],s[i]);return e}},1956:function(e,t,i){var s=i(6324),n=i(748);e.exports=Object.keys||function(e){return s(e,n)}},2262:function(e,t,i){"use strict";var s=i(2109),n=i(7908),a=i(6244),r=i(9303),o=i(1223);s({target:"Array",proto:!0},{at:function(e){var t=n(this),i=a(t),s=r(e),o=s>=0?s:i+s;return o<0||o>=i?void 0:t[o]}}),o("at")},4506:function(e,t,i){"use strict";var s=i(2109),n=i(1702),a=i(4488),r=i(9303),o=i(1340),l=i(7293),d=n("".charAt),c=l((function(){return"\ud842"!=="𠮷".at(-2)}));s({target:"String",proto:!0,forced:c},{at:function(e){var t=o(a(this)),i=t.length,s=r(e),n=s>=0?s:i+s;return n<0||n>=i?void 0:d(t,n)}})},8661:function(e,t,i){"use strict";i.d(t,{Og:function(){return s},uI:function(){return n},yR:function(){return a}});i(2262),i(4506);async function s(){let e=document.querySelector("#messages");e?.scrollTo({top:e.scrollHeight,behavior:"smooth"});const t=[...document.querySelectorAll(".message")].at(-1);return t&&await new Promise((e=>{const i=new IntersectionObserver((([t])=>{t.isIntersecting&&(i.disconnect(),e())}));i.observe(t)})),e}async function n(e){const t=await crypto.subtle.importKey("jwk",{kty:"oct",k:e??localStorage.getItem("key"),alg:"A256GCM"},{name:"AES-GCM"},!0,["encrypt","decrypt"]);return t}async function a(){await new Promise((e=>{const t=new MutationObserver((i=>{const s=i.find((e=>"hcap-script"==e.target.id));if(s){const i=document.querySelector("iframe");i&&(i.onload=()=>{e(),t.disconnect()})}}));t.observe(document.body,{childList:!0,subtree:!0})}))}}}]);